name: Silta
recipe: drupal8

config:
  webroot: web
  via: nginx
  php: '7.2'
  database: mariadb:10.2

tooling:
  codeception:
    service: appserver
    description: Runs Codeception tests
    cmd: /app/vendor/bin/codecept
  drush:
    description: Runs Drush version defined in Composer
    cmd: /app/vendor/bin/drush --root=/app/web
  phpcs:
    service: appserver
    description: Runs PHP_CodeSniffer using Drupal, DrupalPractice standards
    cmd: /app/vendor/bin/phpcs --standard=Drupal,DrupalPractice
  phpcbf:
    service: appserver
    description: Runs PHP Code Beautifier and Fixer using Drupal, DrupalPractice standards
    cmd: /app/vendor/bin/phpcbf --standard=Drupal,DrupalPractice
  phpstan:
    service: appserver
    description: Runs PHP Static Analysis Tool
    cmd: /app/vendor/bin/phpstan
  phpunit:
    service: appserver
    description: Runs PHPUnit tests
    cmd: /app/vendor/bin/phpunit

services:
  appserver:
    overrides:
        environment:
          HASH_SALT: notsosecurehash
  chrome:
    type: compose
    services:
      image: selenium/standalone-chrome
      user: root
      ports:
        - "4444:4444"
      volumes: 
        - /dev/shm:/dev/shm
      command: /opt/bin/entry_point.sh
  mailhog:
    type: mailhog
    hogfrom:
      - appserver

proxy:
  mailhog:
    - mail.lndo.site

events:
  pre-start:
    - appserver: composer install
  post-db-import:
    - appserver: cd $LANDO_WEBROOT && drush cr -y
